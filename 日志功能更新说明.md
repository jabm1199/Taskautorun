# 任务日志查看功能 - 更新说明

## 新增功能概述

我们为自动化定时任务执行系统添加了一个完整的日志查看功能，使用户能够在Web界面上直接查看任务的执行日志，无需登录服务器或手动打开日志文件。该功能支持按任务筛选日志，以及按时间范围和行数限制日志显示。

## 具体实现

### 1. 后端API

我们添加了新的API端点用于获取任务日志：

- **GET /api/logs**：获取所有任务的全局日志
- **GET /api/logs/<task_id>**：获取特定任务的执行日志

这些API支持以下查询参数：
- `days`：获取最近几天的日志（默认1天，0表示全部）
- `lines`：限制返回的日志行数（默认100行，0表示全部）

API返回格式化后的日志数据，包含时间戳、日志级别和消息内容。

### 2. 前端界面

我们添加了以下前端界面组件：

1. **日志查看模态框**：显示日志内容的弹窗
2. **全局日志按钮**：顶部工具栏中的"查看全局日志"按钮
3. **任务日志按钮**：每个任务行中的"日志"按钮
4. **日志筛选选项**：允许用户选择查看的日志范围和行数
5. **刷新日志按钮**：手动刷新日志内容

### 3. 样式设计

为了提高日志的可读性和美观度，我们添加了以下样式：

1. **日志容器**：可滚动的日志显示区域
2. **日志级别标签**：不同颜色标识不同级别的日志（INFO、WARNING、ERROR、DEBUG）
3. **代码样式消息**：使用等宽字体显示日志消息，支持换行和自动断词

## 使用说明

### 查看全局日志

1. 点击顶部工具栏中的"查看全局日志"按钮
2. 在弹出的模态框中可以看到所有任务的执行日志
3. 使用筛选选项调整显示的日志范围和行数
4. 点击"刷新日志"按钮可以获取最新的日志内容

### 查看特定任务日志

1. 在任务列表中找到目标任务
2. 点击该任务行中的"日志"按钮
3. 在弹出的模态框中可以看到该任务的执行日志
4. 使用筛选选项调整显示的日志范围和行数
5. 点击"刷新日志"按钮可以获取最新的日志内容

## 技术细节

1. **日志解析**：服务器端会解析日志文件，提取时间戳、日志级别和消息内容
2. **日志过滤**：支持按任务ID过滤日志，匹配包含特定任务ID的日志行
3. **日期过滤**：根据日志的时间戳过滤出指定天数范围内的日志
4. **动态加载**：前端通过AJAX请求动态加载日志内容
5. **自动滚动**：加载日志后自动滚动到最新日志位置

## 实现文件

1. **routes.py**：添加了`TaskLogsAPI`类，处理日志API请求
2. **index.html**：添加了日志查看模态框和相关按钮
3. **main.js**：添加了日志加载和显示相关的JavaScript函数
4. **style.css**：添加了日志显示相关的CSS样式

## 后续改进方向

1. **实时日志更新**：使用WebSocket实现日志的实时推送
2. **日志搜索功能**：添加关键词搜索功能，快速定位特定日志
3. **日志导出**：支持将日志导出为文件
4. **日志级别过滤**：按日志级别（INFO、WARNING、ERROR等）过滤日志
5. **日志统计图表**：添加日志的统计图表，如错误率、执行成功率等 